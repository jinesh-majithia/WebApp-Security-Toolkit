import os
from scanners.sql_injection_scanner import test_sql_injection
from scanners.xss_scanner import test_xss
from scanners.directory_scanner import directory_scan
from scanners.port_scanner import port_scan
from pathlib import Path

def main():
    """
    Main function to coordinate various security scans on a target URL.
    """
    target_url = input("Enter the target URL (e.g., http://example.com): ").strip()
    
    if not target_url.startswith(("http://", "https://")):
        print("[!] Invalid URL format. Ensure the URL starts with 'http://' or 'https://'.")
        return

    try:
        # SQL Injection Scanner
        print("\n[+] Starting SQL Injection Scanner...")
        test_sql_injection(f"{target_url.rstrip('/')}?id=")

        # XSS Scanner
        print("\n[+] Starting XSS Scanner...")
        test_xss(f"{target_url.rstrip('/')}?search=")

        # Directory Scanner
        print("\n[+] Starting Directory Scanner...")
        wordlist_path = Path("../resources/common_dirs.txt")
        if not wordlist_path.is_file():
            print(f"[!] Wordlist file not found at {wordlist_path}. Skipping Directory Scanner.")
        else:
            directory_scan(target_url, wordlist_path)

        # Port Scanner
        print("\n[+] Starting Port Scanner...")
        port_scan(target_url)

    except Exception as e:
        print(f"[!] An unexpected error occurred: {e}")

if __name__ == "__main__":
    main()
